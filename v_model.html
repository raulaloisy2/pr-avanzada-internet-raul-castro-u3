<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport"
        content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Usando Vue Rulo</title>
    <link rel="stylesheet" type="text/css" href="index.css">
    <link rel="stylesheet" type="text/css" href="table.css">

</head>

<body>
    <div class="container" id="container_app">

    <form class="login"  v-if="!is_login">
        <input type="text" placeholder="Username" v-model ="email" email ="">
        <input type="password" placeholder="Password" v-model="password" password="" >
        <button  @click ="login">Login</button>
      </form>

    <div v-if= "is_login">

        <table class="customTable">
            <thead>
              <tr>
                <th>Personal data</th>
                <th>Contact data</th>
                <th>Company Data</th>
                <th>Actions</th>
              </tr>
            </thead>
            <tbody>
              <tr v-for="u in users">
                <td>{{u.name}}, {{u.username}}</td>
                <td>{{u.email}}, {{u.phone}}</td>
                <td>{{u.company.name}}, {{u.company.bs}}</td>
                <td>
                    <button>Edit</button>
                    <button>Delete</button>
                </td>
              </tr>
    
            </tbody>
          </table>
          <!-- Generated at CSSPortal.com -->   
          <button @click ="add" > New Rercord</button>

          <div v-if="action=='add'">
            <div>
                <label type= "">New Person</label>
                <input type="text" v-model="new_user.name">
              </div> 
    
              <div>
                <label type="text-">Email</label>
                <input type="text" v-model="new_user.email">
              </div>
    
            <div>
                <label type="text-">Company Name</label>
                <input type="text" v-model="new_user.company_name">
            </div>
            <button @click="save('create')">Save User Data</button>
          </div>

     </div>


    </div>
      
      <a href="https://codepen.io/davinci/" target="_blank">check my other pens</a>
    <center>

    

    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script type="text/javascript">

        const { createApp, ref } = Vue

        createApp({
          setup(){

            users= ref([]);
            email= ref('');
            password = ref('');
            action=ref('');
            new_user = ref([]);

           
         let tmp = false;
         tmp = localStorage.getItem("is_login");
         if(tmp == null){
             tmp = false;
         }
            is_login = tmp;
            console.log(is_login)
       
                return {
                    users,
                    email,
                    password,
                    is_login,
                    action,
                    new_user
                }
          },


          mounted: function(){
            const getUsers = async () =>{
                const response = await fetch("user.json?v=1.1");
                const tmp_users= await response.json();
                this.users = tmp_users;
            }
            if(this.is_login){
                getUsers();
            }
          },
          methods:{
            async login(){
                const response =await fetch("user.json?v=1.1");
               this.users= await response.json();
               this.is_login=false;

                this.users.forEach((users)=>
                {
                    if(this.email == users.email){
                        if (this.password == users.password){
                            this.is_login=true;
                            alert("Bienvenido");
                            localStorage.setItem("user_data", JSON.stringify(users));
                            localStorage.setItem("is_login", "true");
                        }
                    }
                }
                );  
            },
            add(){
                this.action="add";
              },
              save(action){
                console.log(action);

                let company=[];
                company.name = this.new_user.company_name;
                this.new_user.company=company;
                this.users.push(this.new_user);
                this.new_user=[];
              },
          },

          update(users){
            console.log("hola");
          }
        }).mount('#container_app');

    </script>
</center>
</body>

</html>